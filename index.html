<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#8B5A2B">
    <title>Autumn's Ferret Farm</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        :root {
            --farm-brown: #8B5A2B;
            --farm-tan: #D2B48C;
            --farm-cream: #FFF8DC;
            --grass-green: #7CB342;
            --sky-blue: #87CEEB;
            --ferret-cream: #F5DEB3;
            --ferret-brown: #8B4513;
            --heart-red: #E74C3C;
            --energy-yellow: #F1C40F;
            --health-green: #2ECC71;
            --hunger-orange: #E67E22;
            --soil-brown: #5D4037;
            --wood-brown: #6D4C41;
            --sunset-orange: #FF7043;
            --cloud-white: #FAFAFA;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(180deg, var(--sky-blue) 0%, #B3E5FC 50%, var(--grass-green) 50%, #558B2F 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated clouds */
        .clouds {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50vh;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .cloud {
            position: absolute;
            background: var(--cloud-white);
            border-radius: 50%;
            opacity: 0.9;
            animation: float-cloud linear infinite;
        }

        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: var(--cloud-white);
            border-radius: 50%;
        }

        .cloud:nth-child(1) { width: 100px; height: 40px; top: 10%; animation-duration: 35s; }
        .cloud:nth-child(1)::before { width: 50px; height: 50px; top: -25px; left: 15px; }
        .cloud:nth-child(1)::after { width: 60px; height: 60px; top: -30px; left: 45px; }

        .cloud:nth-child(2) { width: 80px; height: 32px; top: 25%; animation-duration: 45s; animation-delay: -15s; }
        .cloud:nth-child(2)::before { width: 40px; height: 40px; top: -20px; left: 10px; }
        .cloud:nth-child(2)::after { width: 50px; height: 50px; top: -25px; left: 35px; }

        .cloud:nth-child(3) { width: 120px; height: 48px; top: 5%; animation-duration: 55s; animation-delay: -25s; }
        .cloud:nth-child(3)::before { width: 60px; height: 60px; top: -30px; left: 20px; }
        .cloud:nth-child(3)::after { width: 70px; height: 70px; top: -35px; left: 55px; }

        @keyframes float-cloud {
            from { left: -150px; }
            to { left: 100vw; }
        }

        /* Sun */
        .sun {
            position: fixed;
            top: 20px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFD54F 0%, #FF9800 100%);
            border-radius: 50%;
            box-shadow: 0 0 60px rgba(255, 183, 77, 0.8);
            z-index: 0;
            animation: pulse-sun 4s ease-in-out infinite;
        }

        @keyframes pulse-sun {
            0%, 100% { transform: scale(1); box-shadow: 0 0 60px rgba(255, 183, 77, 0.8); }
            50% { transform: scale(1.05); box-shadow: 0 0 80px rgba(255, 183, 77, 0.9); }
        }

        /* Main container */
        .game-container {
            position: relative;
            z-index: 1;
            max-width: 500px;
            margin: 0 auto;
            padding: 10px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--wood-brown) 0%, var(--farm-brown) 100%);
            border-radius: 20px;
            padding: 15px 20px;
            margin-bottom: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.1);
            border: 4px solid #4E342E;
            text-align: center;
        }

        .header h1 {
            font-family: 'Patrick Hand', cursive;
            font-size: 2rem;
            color: var(--farm-cream);
            text-shadow: 3px 3px 0 #4E342E, -1px -1px 0 #4E342E;
            letter-spacing: 2px;
        }

        .header .subtitle {
            font-size: 0.9rem;
            color: var(--farm-tan);
            margin-top: 5px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            background: linear-gradient(180deg, var(--farm-cream) 0%, var(--farm-tan) 100%);
            border: 3px solid var(--farm-brown);
            border-radius: 15px;
            padding: 10px 16px;
            font-family: 'Fredoka', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--farm-brown);
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 0 var(--wood-brown);
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 var(--wood-brown);
        }

        .nav-tab:active, .nav-tab.active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 var(--wood-brown);
            background: linear-gradient(180deg, var(--farm-tan) 0%, var(--farm-brown) 100%);
            color: var(--farm-cream);
        }

        .nav-tab .icon {
            margin-right: 5px;
        }

        /* Main content area */
        .content-area {
            background: linear-gradient(180deg, var(--farm-cream) 0%, #FFF5E6 100%);
            border-radius: 25px;
            padding: 20px;
            min-height: 60vh;
            border: 5px solid var(--wood-brown);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ferret Card */
        .ferret-card {
            background: linear-gradient(135deg, #FFF8E1 0%, var(--ferret-cream) 100%);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 15px;
            border: 3px solid var(--ferret-brown);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .ferret-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--ferret-brown), var(--farm-tan), var(--ferret-brown));
        }

        .ferret-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .ferret-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--farm-cream);
            border: 3px solid var(--ferret-brown);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .ferret-avatar.sleeping::after {
            content: 'üí§';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .ferret-info h3 {
            font-size: 1.3rem;
            color: var(--ferret-brown);
            margin-bottom: 3px;
        }

        .ferret-personality {
            font-size: 0.85rem;
            color: var(--farm-brown);
            background: var(--farm-tan);
            padding: 3px 10px;
            border-radius: 10px;
            display: inline-block;
        }

        .ferret-age {
            font-size: 0.8rem;
            color: #666;
            margin-top: 3px;
        }

        /* Stats bars */
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-bar {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            padding: 8px;
        }

        .stat-label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--farm-brown);
            margin-bottom: 5px;
        }

        .stat-track {
            height: 12px;
            background: #DDD;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .stat-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
        }

        .stat-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.4) 0%, transparent 100%);
            border-radius: 6px 6px 0 0;
        }

        .stat-hunger .stat-fill { background: linear-gradient(90deg, #FF8A65, var(--hunger-orange)); }
        .stat-happiness .stat-fill { background: linear-gradient(90deg, #F48FB1, var(--heart-red)); }
        .stat-energy .stat-fill { background: linear-gradient(90deg, #FFE082, var(--energy-yellow)); }
        .stat-health .stat-fill { background: linear-gradient(90deg, #81C784, var(--health-green)); }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 80px;
            padding: 10px 12px;
            border: none;
            border-radius: 12px;
            font-family: 'Fredoka', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-feed {
            background: linear-gradient(180deg, #FFCC80, var(--hunger-orange));
            color: white;
            box-shadow: 0 4px 0 #BF360C;
        }

        .btn-play {
            background: linear-gradient(180deg, #F8BBD9, #E91E63);
            color: white;
            box-shadow: 0 4px 0 #880E4F;
        }

        .btn-rest {
            background: linear-gradient(180deg, #B39DDB, #673AB7);
            color: white;
            box-shadow: 0 4px 0 #311B92;
        }

        .btn-adopt-out {
            background: linear-gradient(180deg, #90CAF9, #2196F3);
            color: white;
            box-shadow: 0 4px 0 #0D47A1;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .action-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Farm section */
        .farm-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .farm-plot {
            aspect-ratio: 1;
            background: linear-gradient(180deg, var(--soil-brown) 0%, #3E2723 100%);
            border-radius: 15px;
            border: 3px solid #4E342E;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 -5px 10px rgba(0,0,0,0.3);
        }

        .farm-plot::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .farm-plot:hover {
            transform: scale(1.05);
        }

        .farm-plot.empty {
            background: linear-gradient(180deg, #6D4C41 0%, var(--soil-brown) 100%);
        }

        .farm-plot.empty::after {
            content: '+';
            font-size: 2rem;
            color: rgba(255,255,255,0.3);
        }

        .farm-plot .crop-icon {
            font-size: 2rem;
            margin-bottom: 5px;
            animation: grow-bounce 0.5s ease;
        }

        @keyframes grow-bounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .farm-plot .progress-ring {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .farm-plot .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--grass-green), #4CAF50);
            transition: width 0.5s ease;
        }

        .farm-plot.ready {
            animation: pulse-ready 1s ease-in-out infinite;
        }

        @keyframes pulse-ready {
            0%, 100% { box-shadow: inset 0 -5px 10px rgba(0,0,0,0.3), 0 0 0 0 rgba(76, 175, 80, 0.7); }
            50% { box-shadow: inset 0 -5px 10px rgba(0,0,0,0.3), 0 0 0 10px rgba(76, 175, 80, 0); }
        }

        /* Seed selection */
        .seed-selection {
            background: var(--farm-tan);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 3px dashed var(--farm-brown);
        }

        .seed-selection h3 {
            font-size: 1rem;
            color: var(--farm-brown);
            margin-bottom: 10px;
            text-align: center;
        }

        .seed-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .seed-btn {
            background: var(--farm-cream);
            border: 2px solid var(--farm-brown);
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .seed-btn:hover {
            background: var(--farm-tan);
            transform: translateY(-2px);
        }

        .seed-btn.selected {
            background: var(--grass-green);
            color: white;
            border-color: #388E3C;
        }

        .seed-btn .seed-icon {
            font-size: 1.5rem;
        }

        .seed-btn .seed-name {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .seed-btn .seed-time {
            font-size: 0.65rem;
            opacity: 0.7;
        }

        /* Inventory */
        .inventory {
            background: linear-gradient(135deg, #EFEBE9 0%, #D7CCC8 100%);
            border-radius: 15px;
            padding: 15px;
            border: 3px solid var(--wood-brown);
        }

        .inventory h3 {
            font-size: 1rem;
            color: var(--farm-brown);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .inventory-item {
            background: var(--farm-cream);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            border: 2px solid var(--farm-tan);
        }

        .inventory-item .item-icon {
            font-size: 1.5rem;
            margin-bottom: 3px;
        }

        .inventory-item .item-count {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--farm-brown);
        }

        /* Adoption section */
        .adoption-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            color: var(--farm-brown);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px dotted var(--farm-tan);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shelter-ferrets {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .shelter-card {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            border-radius: 15px;
            padding: 12px;
            border: 3px solid #1976D2;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .shelter-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            border: 2px solid #1976D2;
        }

        .shelter-info {
            flex: 1;
        }

        .shelter-info h4 {
            font-size: 1rem;
            color: #0D47A1;
        }

        .shelter-info p {
            font-size: 0.8rem;
            color: #1565C0;
        }

        .adopt-btn {
            background: linear-gradient(180deg, #4CAF50, #388E3C);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 3px 0 #1B5E20;
            transition: all 0.2s ease;
        }

        .adopt-btn:hover {
            transform: translateY(-2px);
        }

        .adopt-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* Settings/Data section */
        .data-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .data-card {
            background: linear-gradient(135deg, #FAFAFA 0%, #EEEEEE 100%);
            border-radius: 15px;
            padding: 15px;
            border: 3px solid #9E9E9E;
        }

        .data-card h3 {
            font-size: 1rem;
            color: #424242;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .data-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .data-btn:last-child {
            margin-bottom: 0;
        }

        .btn-backup {
            background: linear-gradient(180deg, #81D4FA, #039BE5);
            color: white;
            box-shadow: 0 4px 0 #01579B;
        }

        .btn-restore {
            background: linear-gradient(180deg, #A5D6A7, #43A047);
            color: white;
            box-shadow: 0 4px 0 #1B5E20;
        }

        .btn-reset {
            background: linear-gradient(180deg, #EF9A9A, #E53935);
            color: white;
            box-shadow: 0 4px 0 #B71C1C;
        }

        .data-btn:hover {
            transform: translateY(-2px);
        }

        .data-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* Stats overview */
        .stats-overview {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            border-radius: 15px;
            padding: 15px;
            border: 3px solid var(--hunger-orange);
            margin-bottom: 15px;
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-item .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .stat-item .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--farm-brown);
        }

        .stat-item .stat-name {
            font-size: 0.7rem;
            color: #666;
        }

        /* No ferrets message */
        .no-ferrets {
            text-align: center;
            padding: 40px 20px;
            color: var(--farm-brown);
        }

        .no-ferrets .icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .no-ferrets h3 {
            margin-bottom: 10px;
        }

        .no-ferrets p {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 20px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--farm-cream);
            border-radius: 25px;
            padding: 25px;
            max-width: 400px;
            width: 100%;
            border: 5px solid var(--farm-brown);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: modal-pop 0.3s ease;
        }

        @keyframes modal-pop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal h2 {
            font-size: 1.5rem;
            color: var(--farm-brown);
            margin-bottom: 15px;
            text-align: center;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            border: 3px solid var(--farm-tan);
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--farm-brown);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-btn-cancel {
            background: #E0E0E0;
            color: #666;
        }

        .modal-btn-confirm {
            background: linear-gradient(180deg, #81C784, #43A047);
            color: white;
            box-shadow: 0 3px 0 #1B5E20;
        }

        /* Feed modal */
        .feed-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .feed-option {
            background: var(--farm-tan);
            border: 3px solid var(--farm-brown);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .feed-option:hover:not(.disabled) {
            transform: scale(1.05);
            background: var(--farm-cream);
        }

        .feed-option.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .feed-option .food-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .feed-option .food-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--farm-brown);
        }

        .feed-option .food-count {
            font-size: 0.75rem;
            color: #666;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--farm-brown);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: 600;
            z-index: 2000;
            transition: transform 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* File input hidden */
        .file-input {
            display: none;
        }

        /* Empty state for sections */
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #999;
        }

        .empty-state .emoji {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Goodbye animation */
        .goodbye-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            z-index: 3000;
            animation: float-away 2s ease forwards;
            pointer-events: none;
        }

        @keyframes float-away {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -200%) scale(0.5); }
        }

        /* Responsive */
        @media (max-width: 400px) {
            .nav-tabs {
                gap: 5px;
            }
            .nav-tab {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            .header h1 {
                font-size: 1.6rem;
            }
            .farm-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Install prompt */
        .install-prompt {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            border: 3px solid var(--grass-green);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
        }

        .install-prompt.show {
            display: block;
        }

        .install-prompt p {
            font-size: 0.9rem;
            color: #2E7D32;
            margin-bottom: 10px;
        }

        .install-btn {
            background: linear-gradient(180deg, #66BB6A, #43A047);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 3px 0 #2E7D32;
        }

        .dismiss-install {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            margin-left: 10px;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Background elements -->
    <div class="sun"></div>
    <div class="clouds">
        <div class="cloud"></div>
        <div class="cloud"></div>
        <div class="cloud"></div>
    </div>

    <!-- Main game container -->
    <div class="game-container">
        <!-- Header -->
        <header class="header">
            <h1>ü¶° Autumn's Ferret Farm ü¶°</h1>
            <p class="subtitle">Care for your fuzzy friends!</p>
        </header>

        <!-- Install prompt -->
        <div class="install-prompt" id="installPrompt">
            <p>üì± Install this app for the best experience!</p>
            <button class="install-btn" id="installBtn">Install App</button>
            <button class="dismiss-install" id="dismissInstall">Not now</button>
        </div>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="ferrets">
                <span class="icon">ü¶°</span>Ferrets
            </button>
            <button class="nav-tab" data-tab="farm">
                <span class="icon">üåæ</span>Farm
            </button>
            <button class="nav-tab" data-tab="adoption">
                <span class="icon">üè†</span>Adopt
            </button>
            <button class="nav-tab" data-tab="data">
                <span class="icon">üíæ</span>Data
            </button>
        </nav>

        <!-- Content area -->
        <main class="content-area">
            <!-- Ferrets Tab -->
            <div class="tab-content active" id="ferretsTab">
                <div class="stats-overview">
                    <div class="stats-row">
                        <div class="stat-item">
                            <span class="stat-icon">ü¶°</span>
                            <span class="stat-value" id="ferretCount">0</span>
                            <span class="stat-name">Ferrets</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üåæ</span>
                            <span class="stat-value" id="totalFood">0</span>
                            <span class="stat-name">Food</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üíù</span>
                            <span class="stat-value" id="adoptedOut">0</span>
                            <span class="stat-name">Adopted Out</span>
                        </div>
                    </div>
                </div>
                <div id="ferretsList"></div>
            </div>

            <!-- Farm Tab -->
            <div class="tab-content" id="farmTab">
                <div class="seed-selection">
                    <h3>üå± Select Seeds to Plant</h3>
                    <div class="seed-options">
                        <button class="seed-btn selected" data-seed="carrot">
                            <span class="seed-icon">ü•ï</span>
                            <span class="seed-name">Carrots</span>
                            <span class="seed-time">30s</span>
                        </button>
                        <button class="seed-btn" data-seed="chicken">
                            <span class="seed-icon">üçó</span>
                            <span class="seed-name">Chicken</span>
                            <span class="seed-time">60s</span>
                        </button>
                        <button class="seed-btn" data-seed="egg">
                            <span class="seed-icon">ü•ö</span>
                            <span class="seed-name">Eggs</span>
                            <span class="seed-time">45s</span>
                        </button>
                        <button class="seed-btn" data-seed="treat">
                            <span class="seed-icon">üç¨</span>
                            <span class="seed-name">Treats</span>
                            <span class="seed-time">90s</span>
                        </button>
                    </div>
                </div>

                <div class="farm-grid" id="farmGrid"></div>

                <div class="inventory">
                    <h3>üì¶ Food Storage</h3>
                    <div class="inventory-grid">
                        <div class="inventory-item">
                            <div class="item-icon">ü•ï</div>
                            <div class="item-count" id="carrotCount">0</div>
                        </div>
                        <div class="inventory-item">
                            <div class="item-icon">üçó</div>
                            <div class="item-count" id="chickenCount">0</div>
                        </div>
                        <div class="inventory-item">
                            <div class="item-icon">ü•ö</div>
                            <div class="item-count" id="eggCount">0</div>
                        </div>
                        <div class="inventory-item">
                            <div class="item-icon">üç¨</div>
                            <div class="item-count" id="treatCount">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Adoption Tab -->
            <div class="tab-content" id="adoptionTab">
                <div class="adoption-section">
                    <h3 class="section-title">üè† Ferret Shelter</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                        Give a loving home to a ferret in need!
                    </p>
                    <div class="shelter-ferrets" id="shelterFerrets"></div>
                </div>

                <div class="adoption-section">
                    <h3 class="section-title">üíï Happy Adoptions</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                        Ferrets you've helped find loving families!
                    </p>
                    <div id="adoptedFerrets"></div>
                </div>
            </div>

            <!-- Data Tab -->
            <div class="tab-content" id="dataTab">
                <div class="data-section">
                    <div class="data-card">
                        <h3>üíæ Backup & Restore</h3>
                        <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
                            Save your progress to a file or restore from a backup.
                        </p>
                        <button class="data-btn btn-backup" id="backupBtn">
                            ‚¨áÔ∏è Download Backup
                        </button>
                        <button class="data-btn btn-restore" id="restoreBtn">
                            ‚¨ÜÔ∏è Restore from File
                        </button>
                        <input type="file" class="file-input" id="restoreInput" accept=".json">
                    </div>

                    <div class="data-card">
                        <h3>‚ö†Ô∏è Danger Zone</h3>
                        <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
                            This will delete ALL your progress!
                        </p>
                        <button class="data-btn btn-reset" id="resetBtn">
                            üóëÔ∏è Reset Everything
                        </button>
                    </div>

                    <div class="data-card">
                        <h3>‚ÑπÔ∏è About</h3>
                        <p style="font-size: 0.85rem; color: #666; line-height: 1.6;">
                            <strong>Autumn's Ferret Farm</strong> is a Tamagotchi-style game where you care for adorable ferrets!
                            <br><br>
                            ü¶° Feed, play with, and rest your ferrets<br>
                            üåæ Grow food on your farm<br>
                            üè† Adopt ferrets or find them loving homes<br>
                            üíæ Your progress saves automatically!
                        </p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Feed Modal -->
    <div class="modal-overlay" id="feedModal">
        <div class="modal">
            <h2>üçΩÔ∏è Feed <span id="feedFerretName"></span></h2>
            <div class="feed-options" id="feedOptions"></div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="closeFeedModal">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Name Modal -->
    <div class="modal-overlay" id="nameModal">
        <div class="modal">
            <h2>ü¶° Name Your New Ferret!</h2>
            <input type="text" class="modal-input" id="ferretNameInput" placeholder="Enter a name..." maxlength="20">
            <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
                Personality: <strong id="newFerretPersonality"></strong>
            </p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="cancelAdopt">Cancel</button>
                <button class="modal-btn modal-btn-confirm" id="confirmAdopt">Adopt!</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <h2 id="confirmTitle">Confirm</h2>
            <p id="confirmMessage" style="margin-bottom: 15px; color: #666;"></p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="confirmCancel">Cancel</button>
                <button class="modal-btn modal-btn-confirm" id="confirmOk">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ============================================
        // AUTUMN'S FERRET FARM - GAME ENGINE
        // ============================================

        // Game configuration
        const CONFIG = {
            TICK_RATE: 1000, // 1 second
            STAT_DECAY_RATE: 0.1, // per tick
            CROPS: {
                carrot: { icon: 'ü•ï', growTime: 30, hungerBoost: 15 },
                chicken: { icon: 'üçó', growTime: 60, hungerBoost: 25 },
                egg: { icon: 'ü•ö', growTime: 45, hungerBoost: 20 },
                treat: { icon: 'üç¨', growTime: 90, hungerBoost: 10, happinessBoost: 15 }
            },
            PERSONALITIES: [
                { name: 'Playful', emoji: 'üéÆ', hungerDecay: 1.2, happinessDecay: 0.8, energyDecay: 1.3 },
                { name: 'Lazy', emoji: 'üò¥', hungerDecay: 0.8, happinessDecay: 1.0, energyDecay: 0.7 },
                { name: 'Curious', emoji: 'üîç', hungerDecay: 1.0, happinessDecay: 0.9, energyDecay: 1.1 },
                { name: 'Mischievous', emoji: 'üòà', hungerDecay: 1.1, happinessDecay: 1.1, energyDecay: 1.2 },
                { name: 'Cuddly', emoji: 'ü§ó', hungerDecay: 0.9, happinessDecay: 0.7, energyDecay: 0.9 },
                { name: 'Adventurous', emoji: 'üåü', hungerDecay: 1.3, happinessDecay: 1.0, energyDecay: 1.4 }
            ],
            FERRET_COLORS: ['ü¶°', 'ü¶¶', 'üêøÔ∏è', 'üêæ'],
            SHELTER_REFRESH_TIME: 60000, // 1 minute
            PLOT_COUNT: 6
        };

        // Database name for IndexedDB
        const DB_NAME = 'AutumnsFerretFarm';
        const DB_VERSION = 1;
        const STORE_NAME = 'gameData';

        // Game state
        let gameState = {
            ferrets: [],
            inventory: { carrot: 5, chicken: 2, egg: 3, treat: 1 },
            farm: [],
            shelter: [],
            adoptedOut: [],
            stats: { totalAdoptedOut: 0 },
            lastUpdate: Date.now()
        };

        let db = null;
        let selectedSeed = 'carrot';
        let pendingAdoption = null;
        let confirmCallback = null;
        let feedingFerretId = null;

        // ============================================
        // DATABASE FUNCTIONS (IndexedDB)
        // ============================================

        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    if (!database.objectStoreNames.contains(STORE_NAME)) {
                        database.createObjectStore(STORE_NAME, { keyPath: 'id' });
                    }
                };
            });
        }

        async function saveGame() {
            if (!db) return;

            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);

                gameState.lastUpdate = Date.now();
                const request = store.put({ id: 'save', data: gameState });

                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function loadGame() {
            if (!db) return null;

            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.get('save');

                request.onsuccess = () => {
                    if (request.result) {
                        resolve(request.result.data);
                    } else {
                        resolve(null);
                    }
                };
                request.onerror = () => reject(request.error);
            });
        }

        // ============================================
        // GAME LOGIC
        // ============================================

        function generateFerret(name = null) {
            const personality = CONFIG.PERSONALITIES[Math.floor(Math.random() * CONFIG.PERSONALITIES.length)];
            const color = CONFIG.FERRET_COLORS[Math.floor(Math.random() * CONFIG.FERRET_COLORS.length)];

            return {
                id: Date.now() + Math.random(),
                name: name || generateFerretName(),
                personality: personality,
                color: color,
                hunger: 70 + Math.random() * 30,
                happiness: 70 + Math.random() * 30,
                energy: 70 + Math.random() * 30,
                health: 100,
                age: 0,
                isResting: false,
                created: Date.now()
            };
        }

        function generateFerretName() {
            const names = [
                'Noodle', 'Slinky', 'Bandit', 'Cookie', 'Ziggy', 'Pepper',
                'Cocoa', 'Maple', 'Hazel', 'Peanut', 'Biscuit', 'Mochi',
                'Waffles', 'Nugget', 'Sprout', 'Cinnamon', 'Butterscotch', 'Toffee',
                'Whiskers', 'Fuzzy', 'Snickers', 'Caramel', 'Pretzel', 'Churro'
            ];
            return names[Math.floor(Math.random() * names.length)];
        }

        function updateFerretStats() {
            const now = Date.now();
            const elapsed = (now - gameState.lastUpdate) / 1000; // seconds

            gameState.ferrets.forEach(ferret => {
                if (!ferret.isResting) {
                    // Decay stats based on personality
                    ferret.hunger -= CONFIG.STAT_DECAY_RATE * elapsed * ferret.personality.hungerDecay;
                    ferret.happiness -= CONFIG.STAT_DECAY_RATE * elapsed * ferret.personality.happinessDecay;
                    ferret.energy -= CONFIG.STAT_DECAY_RATE * elapsed * ferret.personality.energyDecay * 0.5;
                } else {
                    // Resting recovers energy
                    ferret.energy += CONFIG.STAT_DECAY_RATE * elapsed * 2;
                    ferret.happiness -= CONFIG.STAT_DECAY_RATE * elapsed * 0.3;
                }

                // Clamp values
                ferret.hunger = Math.max(0, Math.min(100, ferret.hunger));
                ferret.happiness = Math.max(0, Math.min(100, ferret.happiness));
                ferret.energy = Math.max(0, Math.min(100, ferret.energy));

                // Health affected by low stats
                const avgStats = (ferret.hunger + ferret.happiness + ferret.energy) / 3;
                if (avgStats < 30) {
                    ferret.health -= CONFIG.STAT_DECAY_RATE * elapsed * 0.5;
                } else if (avgStats > 70) {
                    ferret.health += CONFIG.STAT_DECAY_RATE * elapsed * 0.2;
                }
                ferret.health = Math.max(0, Math.min(100, ferret.health));

                // Age increases
                ferret.age += elapsed / 60; // Age in minutes
            });

            // Update farm plots
            gameState.farm.forEach(plot => {
                if (plot.crop && !plot.ready) {
                    plot.progress += elapsed;
                    if (plot.progress >= CONFIG.CROPS[plot.crop].growTime) {
                        plot.ready = true;
                    }
                }
            });

            gameState.lastUpdate = now;
        }

        function feedFerret(ferretId, food) {
            const ferret = gameState.ferrets.find(f => f.id === ferretId);
            if (!ferret || gameState.inventory[food] <= 0) return false;

            gameState.inventory[food]--;
            ferret.hunger += CONFIG.CROPS[food].hungerBoost;
            if (CONFIG.CROPS[food].happinessBoost) {
                ferret.happiness += CONFIG.CROPS[food].happinessBoost;
            }

            ferret.hunger = Math.min(100, ferret.hunger);
            ferret.happiness = Math.min(100, ferret.happiness);

            showToast(`${ferret.name} enjoyed the ${food}! üòã`);
            saveGame();
            renderFerrets();
            updateOverviewStats();
            return true;
        }

        function playWithFerret(ferretId) {
            const ferret = gameState.ferrets.find(f => f.id === ferretId);
            if (!ferret || ferret.energy < 10) {
                showToast(`${ferret.name} is too tired to play! üò¥`);
                return false;
            }

            ferret.happiness += 20;
            ferret.energy -= 15;
            ferret.hunger -= 5;

            ferret.happiness = Math.min(100, ferret.happiness);
            ferret.energy = Math.max(0, ferret.energy);
            ferret.hunger = Math.max(0, ferret.hunger);

            showToast(`${ferret.name} had so much fun! üéâ`);
            saveGame();
            renderFerrets();
            return true;
        }

        function toggleRest(ferretId) {
            const ferret = gameState.ferrets.find(f => f.id === ferretId);
            if (!ferret) return;

            ferret.isResting = !ferret.isResting;
            showToast(ferret.isResting ? `${ferret.name} is resting... üí§` : `${ferret.name} woke up! üåü`);
            saveGame();
            renderFerrets();
        }

        function plantCrop(plotIndex) {
            if (gameState.farm[plotIndex].crop) return;

            gameState.farm[plotIndex] = {
                crop: selectedSeed,
                progress: 0,
                ready: false
            };

            showToast(`Planted ${CONFIG.CROPS[selectedSeed].icon}!`);
            saveGame();
            renderFarm();
        }

        function harvestCrop(plotIndex) {
            const plot = gameState.farm[plotIndex];
            if (!plot.ready) return;

            gameState.inventory[plot.crop]++;
            gameState.farm[plotIndex] = { crop: null, progress: 0, ready: false };

            showToast(`Harvested ${CONFIG.CROPS[plot.crop].icon}!`);
            saveGame();
            renderFarm();
            updateOverviewStats();
        }

        function adoptFerret(shelterIndex) {
            const ferret = gameState.shelter[shelterIndex];
            if (!ferret) return;

            pendingAdoption = { ferret, index: shelterIndex };
            document.getElementById('newFerretPersonality').textContent = 
                `${ferret.personality.emoji} ${ferret.personality.name}`;
            document.getElementById('ferretNameInput').value = ferret.name;
            document.getElementById('nameModal').classList.add('active');
        }

        function confirmAdoption() {
            if (!pendingAdoption) return;

            const name = document.getElementById('ferretNameInput').value.trim();
            if (!name) {
                showToast('Please enter a name!');
                return;
            }

            pendingAdoption.ferret.name = name;
            gameState.ferrets.push(pendingAdoption.ferret);
            gameState.shelter.splice(pendingAdoption.index, 1);

            document.getElementById('nameModal').classList.remove('active');
            showToast(`Welcome ${name} to the family! üéâ`);
            
            pendingAdoption = null;
            saveGame();
            renderAll();
        }

        function putUpForAdoption(ferretId) {
            const ferret = gameState.ferrets.find(f => f.id === ferretId);
            if (!ferret) return;

            showConfirm(
                'üíï Find a New Home?',
                `Are you sure you want to find a loving family for ${ferret.name}? They will be very happy!`,
                () => {
                    gameState.ferrets = gameState.ferrets.filter(f => f.id !== ferretId);
                    gameState.adoptedOut.push({
                        name: ferret.name,
                        personality: ferret.personality,
                        color: ferret.color,
                        adoptedDate: Date.now()
                    });
                    gameState.stats.totalAdoptedOut++;

                    // Show goodbye animation
                    showGoodbyeAnimation(ferret);

                    saveGame();
                    renderAll();
                }
            );
        }

        function showGoodbyeAnimation(ferret) {
            const el = document.createElement('div');
            el.className = 'goodbye-animation';
            el.textContent = `${ferret.color} üíï`;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 2000);
            showToast(`${ferret.name} found a loving home! üè†üíï`);
        }

        function refreshShelter() {
            gameState.shelter = [];
            const count = 2 + Math.floor(Math.random() * 2);
            for (let i = 0; i < count; i++) {
                gameState.shelter.push(generateFerret());
            }
            saveGame();
            renderShelter();
        }

        // ============================================
        // RENDERING FUNCTIONS
        // ============================================

        function renderFerrets() {
            const container = document.getElementById('ferretsList');

            if (gameState.ferrets.length === 0) {
                container.innerHTML = `
                    <div class="no-ferrets">
                        <div class="icon">ü¶°</div>
                        <h3>No Ferrets Yet!</h3>
                        <p>Visit the Adopt tab to find your first fuzzy friend!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = gameState.ferrets.map(ferret => `
                <div class="ferret-card">
                    <div class="ferret-header">
                        <div class="ferret-avatar ${ferret.isResting ? 'sleeping' : ''}">
                            ${ferret.color}
                        </div>
                        <div class="ferret-info">
                            <h3>${ferret.name}</h3>
                            <span class="ferret-personality">${ferret.personality.emoji} ${ferret.personality.name}</span>
                            <div class="ferret-age">Age: ${Math.floor(ferret.age)} min</div>
                        </div>
                    </div>
                    <div class="stats-container">
                        <div class="stat-bar stat-hunger">
                            <div class="stat-label">üçñ Hunger</div>
                            <div class="stat-track">
                                <div class="stat-fill" style="width: ${ferret.hunger}%; background: ${getStatColor(ferret.hunger)}"></div>
                            </div>
                        </div>
                        <div class="stat-bar stat-happiness">
                            <div class="stat-label">üíñ Happy</div>
                            <div class="stat-track">
                                <div class="stat-fill" style="width: ${ferret.happiness}%"></div>
                            </div>
                        </div>
                        <div class="stat-bar stat-energy">
                            <div class="stat-label">‚ö° Energy</div>
                            <div class="stat-track">
                                <div class="stat-fill" style="width: ${ferret.energy}%"></div>
                            </div>
                        </div>
                        <div class="stat-bar stat-health">
                            <div class="stat-label">üíö Health</div>
                            <div class="stat-track">
                                <div class="stat-fill" style="width: ${ferret.health}%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn btn-feed" onclick="openFeedModal('${ferret.id}')">
                            üçΩÔ∏è Feed
                        </button>
                        <button class="action-btn btn-play" onclick="playWithFerret('${ferret.id}')" ${ferret.energy < 10 ? 'disabled' : ''}>
                            üéÆ Play
                        </button>
                        <button class="action-btn btn-rest" onclick="toggleRest('${ferret.id}')">
                            ${ferret.isResting ? '‚òÄÔ∏è Wake' : 'üò¥ Rest'}
                        </button>
                        <button class="action-btn btn-adopt-out" onclick="putUpForAdoption('${ferret.id}')">
                            üè† Adopt
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getStatColor(value) {
            if (value > 60) return 'linear-gradient(90deg, #81C784, #4CAF50)';
            if (value > 30) return 'linear-gradient(90deg, #FFB74D, #FF9800)';
            return 'linear-gradient(90deg, #EF9A9A, #F44336)';
        }

        function renderFarm() {
            const container = document.getElementById('farmGrid');

            container.innerHTML = gameState.farm.map((plot, index) => {
                if (!plot.crop) {
                    return `<div class="farm-plot empty" onclick="plantCrop(${index})"></div>`;
                }

                const crop = CONFIG.CROPS[plot.crop];
                const progress = Math.min(100, (plot.progress / crop.growTime) * 100);

                return `
                    <div class="farm-plot ${plot.ready ? 'ready' : ''}" onclick="${plot.ready ? `harvestCrop(${index})` : ''}">
                        <span class="crop-icon">${crop.icon}</span>
                        ${!plot.ready ? `
                            <div class="progress-ring">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        ` : '<span style="font-size: 0.7rem; color: #4CAF50; font-weight: bold;">READY!</span>'}
                    </div>
                `;
            }).join('');

            // Update inventory display
            document.getElementById('carrotCount').textContent = gameState.inventory.carrot;
            document.getElementById('chickenCount').textContent = gameState.inventory.chicken;
            document.getElementById('eggCount').textContent = gameState.inventory.egg;
            document.getElementById('treatCount').textContent = gameState.inventory.treat;
        }

        function renderShelter() {
            const container = document.getElementById('shelterFerrets');

            if (gameState.shelter.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üè†</div>
                        <p>No ferrets in the shelter right now.<br>Check back soon!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = gameState.shelter.map((ferret, index) => `
                <div class="shelter-card">
                    <div class="shelter-avatar">${ferret.color}</div>
                    <div class="shelter-info">
                        <h4>${ferret.name}</h4>
                        <p>${ferret.personality.emoji} ${ferret.personality.name}</p>
                    </div>
                    <button class="adopt-btn" onclick="adoptFerret(${index})">
                        Adopt! üíï
                    </button>
                </div>
            `).join('');
        }

        function renderAdoptedOut() {
            const container = document.getElementById('adoptedFerrets');

            if (gameState.adoptedOut.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üíï</div>
                        <p>No ferrets adopted out yet.<br>When you find them loving homes, they'll appear here!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = gameState.adoptedOut.map(ferret => `
                <div class="shelter-card" style="background: linear-gradient(135deg, #FCE4EC 0%, #F8BBD9 100%); border-color: #E91E63;">
                    <div class="shelter-avatar" style="border-color: #E91E63;">${ferret.color}</div>
                    <div class="shelter-info">
                        <h4 style="color: #880E4F;">${ferret.name}</h4>
                        <p style="color: #AD1457;">${ferret.personality.emoji} ${ferret.personality.name}</p>
                        <p style="font-size: 0.7rem; color: #C2185B;">Found a home ${formatTimeAgo(ferret.adoptedDate)}</p>
                    </div>
                    <span style="font-size: 1.5rem;">üè†üíï</span>
                </div>
            `).join('');
        }

        function updateOverviewStats() {
            document.getElementById('ferretCount').textContent = gameState.ferrets.length;
            document.getElementById('totalFood').textContent = 
                Object.values(gameState.inventory).reduce((a, b) => a + b, 0);
            document.getElementById('adoptedOut').textContent = gameState.stats.totalAdoptedOut;
        }

        function renderAll() {
            renderFerrets();
            renderFarm();
            renderShelter();
            renderAdoptedOut();
            updateOverviewStats();
        }

        // ============================================
        // UI FUNCTIONS
        // ============================================

        function openFeedModal(ferretId) {
            feedingFerretId = ferretId;
            const ferret = gameState.ferrets.find(f => f.id == ferretId);
            if (!ferret) return;

            document.getElementById('feedFerretName').textContent = ferret.name;

            const options = document.getElementById('feedOptions');
            options.innerHTML = Object.entries(CONFIG.CROPS).map(([key, crop]) => `
                <div class="feed-option ${gameState.inventory[key] <= 0 ? 'disabled' : ''}" 
                     onclick="${gameState.inventory[key] > 0 ? `selectFood('${key}')` : ''}">
                    <div class="food-icon">${crop.icon}</div>
                    <div class="food-name">${key.charAt(0).toUpperCase() + key.slice(1)}</div>
                    <div class="food-count">√ó${gameState.inventory[key]}</div>
                </div>
            `).join('');

            document.getElementById('feedModal').classList.add('active');
        }

        function selectFood(food) {
            if (feedingFerretId && gameState.inventory[food] > 0) {
                feedFerret(feedingFerretId, food);
                document.getElementById('feedModal').classList.remove('active');
                feedingFerretId = null;
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        function showConfirm(title, message, callback) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            confirmCallback = callback;
            document.getElementById('confirmModal').classList.add('active');
        }

        function formatTimeAgo(timestamp) {
            const diff = Date.now() - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
            if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            if (minutes > 0) return `${minutes} min${minutes > 1 ? 's' : ''} ago`;
            return 'just now';
        }

        // ============================================
        // BACKUP & RESTORE
        // ============================================

        function downloadBackup() {
            const data = JSON.stringify(gameState, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ferret-farm-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Backup downloaded! üíæ');
        }

        function restoreBackup(file) {
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    // Validate the data has expected structure
                    if (!data.ferrets || !data.inventory || !data.farm) {
                        throw new Error('Invalid backup file');
                    }
                    gameState = data;
                    gameState.lastUpdate = Date.now();
                    await saveGame();
                    renderAll();
                    showToast('Backup restored! üéâ');
                } catch (error) {
                    showToast('Invalid backup file! üò¢');
                }
            };
            reader.readAsText(file);
        }

        function resetGame() {
            showConfirm(
                '‚ö†Ô∏è Reset Everything?',
                'This will delete ALL your ferrets, farm, and progress. This cannot be undone!',
                async () => {
                    gameState = {
                        ferrets: [],
                        inventory: { carrot: 5, chicken: 2, egg: 3, treat: 1 },
                        farm: [],
                        shelter: [],
                        adoptedOut: [],
                        stats: { totalAdoptedOut: 0 },
                        lastUpdate: Date.now()
                    };
                    initializeFarm();
                    refreshShelter();
                    await saveGame();
                    renderAll();
                    showToast('Game reset! Starting fresh! üå±');
                }
            );
        }

        function initializeFarm() {
            gameState.farm = [];
            for (let i = 0; i < CONFIG.PLOT_COUNT; i++) {
                gameState.farm.push({ crop: null, progress: 0, ready: false });
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================

        function setupEventListeners() {
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
                });
            });

            // Seed selection
            document.querySelectorAll('.seed-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.seed-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedSeed = btn.dataset.seed;
                });
            });

            // Modals
            document.getElementById('closeFeedModal').addEventListener('click', () => {
                document.getElementById('feedModal').classList.remove('active');
            });

            document.getElementById('cancelAdopt').addEventListener('click', () => {
                document.getElementById('nameModal').classList.remove('active');
                pendingAdoption = null;
            });

            document.getElementById('confirmAdopt').addEventListener('click', confirmAdoption);

            document.getElementById('ferretNameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') confirmAdoption();
            });

            document.getElementById('confirmCancel').addEventListener('click', () => {
                document.getElementById('confirmModal').classList.remove('active');
                confirmCallback = null;
            });

            document.getElementById('confirmOk').addEventListener('click', () => {
                document.getElementById('confirmModal').classList.remove('active');
                if (confirmCallback) {
                    confirmCallback();
                    confirmCallback = null;
                }
            });

            // Data buttons
            document.getElementById('backupBtn').addEventListener('click', downloadBackup);
            document.getElementById('restoreBtn').addEventListener('click', () => {
                document.getElementById('restoreInput').click();
            });
            document.getElementById('restoreInput').addEventListener('change', (e) => {
                if (e.target.files[0]) {
                    restoreBackup(e.target.files[0]);
                    e.target.value = '';
                }
            });
            document.getElementById('resetBtn').addEventListener('click', resetGame);

            // Close modals on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });
        }

        // ============================================
        // PWA INSTALL PROMPT
        // ============================================

        let deferredPrompt = null;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.add('show');
        });

        document.getElementById('installBtn')?.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const result = await deferredPrompt.userChoice;
                if (result.outcome === 'accepted') {
                    showToast('App installed! üéâ');
                }
                deferredPrompt = null;
                document.getElementById('installPrompt').classList.remove('show');
            }
        });

        document.getElementById('dismissInstall')?.addEventListener('click', () => {
            document.getElementById('installPrompt').classList.remove('show');
        });

        // ============================================
        // GAME LOOP
        // ============================================

        function gameLoop() {
            updateFerretStats();
            renderFerrets();
            renderFarm();
            saveGame();
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        async function init() {
            try {
                await initDB();
                const savedState = await loadGame();

                if (savedState) {
                    gameState = savedState;
                    // Ensure all expected properties exist
                    gameState.adoptedOut = gameState.adoptedOut || [];
                    gameState.stats = gameState.stats || { totalAdoptedOut: 0 };
                    gameState.shelter = gameState.shelter || [];
                }

                if (gameState.farm.length === 0) {
                    initializeFarm();
                }

                if (gameState.shelter.length === 0) {
                    refreshShelter();
                }

                setupEventListeners();
                renderAll();

                // Start game loop
                setInterval(gameLoop, CONFIG.TICK_RATE);

                // Refresh shelter periodically
                setInterval(refreshShelter, CONFIG.SHELTER_REFRESH_TIME);

                // Register service worker
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('sw.js').catch(console.error);
                }

                console.log('ü¶° Autumn\'s Ferret Farm loaded!');
            } catch (error) {
                console.error('Failed to initialize game:', error);
                showToast('Error loading game. Please refresh.');
            }
        }

        // Start the game
        init();
    </script>
</body>
</html>
